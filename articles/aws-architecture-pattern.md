---
title: "AWS定番業務システム 14パターン設計ガイド"
emoji: "☁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS"]
published: false
---

# 書籍
https://honto.jp/netstore/pd-book_29210426.html

# 1章 Webシステム
## 1-1［パターン1］キャンペーンサイト
リージョン選択
- リージョンによってレスポンスとコストが変わる
  - 地理的に近いリージョンのほうがレスポンスは速いが、遠いリージョンのほうが安かったりする。
  - リージョンは一度決めると変更にかなり手間がかかる。目的に合ったリージョン選択をすること。

VPCサブネット
- サブネットの分け方
  - 論理的なネットワークを設計して、AWSでのサブネット実装に紐づけていく。
  - 【例：WebサーバーとDBサーバーの場合】
    2つのサーバーではフィルタリングポリシーが異なるため、サブネットを分ける。
    - Webサーバー：インターネットからのHTTP受信を許可。
    - DBサーバー：Webサーバーからのデータベース接続のみ許可。
  - （サブネットは、単一のAZ内に作成。）

セキュリティグループ設定でのフィルタリング
- EC2インスタンスに設定するセキュリティグループ
  - SSH(TCP, ポート22) : 自社グローバルIPアドレスを指定。
  - HTTP(S) : 0.0.0.0/0（ALL）

固定IPとホスト名でアクセス可能に
- 取得した秘密鍵はSSHクライアントに読み込ませる。（大切に保管。）
- FQDN : 完全修飾ドメイン名 / 絶対ドメイン名。`www.example.co.jp`のようにドメイン名を省略せずにすべて指定した表記のこと。
- 外部からFQDNでアクセスするための設定
  - ElasticIPで固定のグローバルIPアドレスを設定。
  - Route53でDNSを定義。

インターネット接続を可能に
- サブネット→外部にアクセスするためには、下記のようにルートテーブルに登録。
  - パブリックサブネットの場合
    - 送信先: 0.0.0.0/0
    - ターゲット: **インターネットゲートウェイ**
  - プライベートサブネットの場合
    - 送信先: 0.0.0.0/0
    - ターゲット: **NATゲートウェイ**

OS環境をWebサーバーとして使えるように設定
- ec2user : AmazonLinuxで管理者としてデフォルトで登録されているユーザ。

## 1-2［パターン2］コーポレートサイト
ELBでのWebサーバーの冗長化
- セットアップしたインスタンスは、AMIとして登録して、それを元にインスタンスを複製する。（何回もセットアップしなくて済む。）

ELB設定ポイント
- セキュリティグループ設定
  - ELB
    HTTP(S) : 0.0.0.0/0（ALL）
  - EC2インスタンス
    HTTP : 10.0.0.0/24（ELBが属するサブネット）
- セッション
  セッション維持が必要であれば、ELB自身が作成するCookieの情報を素に同じサーバーに振り分ける**スティッキーセッション**を設定する。
- SSLターミネーション
  ELBにSSL証明書を登録しておくことで、暗号/復号処理をELBで行う。
  このことで、クライアント→ELBは`HTTPS`、ELB→Webサーバーは`HTTP`で通信できる。
  - 個々のWebサーバーに証明書を登録する必要がなくなる。
  - SSL復号処理の負担が下がる。（インスタンスのコストが下がる。）

RDSでのDBサーバーの冗長化
- マルチAZ設定
  異なるAZに複数のサブネットを用意。そしてそれらを束ねるサブネットグループを作成し、RDSにアタッチする。
- マスターのDBサーバーに障害が起きた場合、スレーブがマスターに自動で昇格する。
  ただし、WebサーバーとDBサーバーとの接続切り替えは別途必要。

静的コンテンツを低コストに配信する
- S3
  静的コンテンツはS3に置くほうがEC2内よりも安価。
- CloudFront
  - 参照先振り分け機能
    動的コンテンツはELB, 静的コンテンツはS3 といったように振り分けできる。
    ただし、ワイルドカード指定で動的コンテンツと静的コンテンツを区別できる場合でないと難しい。（設定が煩雑）
    （`/javascript/*`, `/image/*`など）

## 1-3［パターン3］性能重視のイントラWeb
アプリサーバーのスケーリング
- AutoScaling
  - AutoScalingには、CloudWatchを組み合わせる。
    - CloudWatchは、インスタンスを監視して、処理能力が不足するとアラートを通知する。
    - AutoScalingは、アラートをトリガーに、新しいアプリケーションサーバーを自動起動。
      - トリガーのメトリクスは色々な項目から選択できるが、軽く調べたところでは`CPU利用率`を設定しているところが多かった。
  - **AutoScalingグループに、ELBをアタッチする**。
    - ELB宛てのリクエストがAutoScalingグループのインスタンスに振り分けられる。
  - **AutoScalingグループに、AMIを登録する**。
    - リリースの度にAMIを更新するのは運用が煩雑になるため、インスタンス起動時にスクリプトを実行する**ユーザデータ**という機能を使うと良い。
      (ユーザデータの処理が多くなって処理が長くなるとスケールアウトのときに時間がかかる。)
  - スケールインした後も使うデータ（ログなど）はEBS領域に格納しておく。

## 1-4［パターン4］可用性重視のイントラWeb

# 2章 ストレージシステム
## 2-1［パターン5］バックアップ
## 2-2［パターン6］ファイルサーバー

# 3章　データ分析システム
略。
- 3-1［パターン7］構造化データの分析
- 3-2［パターン8］非構造化データの分析
- 3-3［パターン9］AI とIoT


# 4章　アプリケーションの高速開発
## 4-1［パターン10］サーバーアプリの高速開発
## 4-2［パターン11］モバイルアプリの高速開発
略。

# 5章　クラウドネイティブ
## 5-1［パターン12］サーバーレスのインフラ
## 5-2［パターン13］マイクロサービスの運用基盤

# 6章　ハイブリッドクラウド
略。
- 6-1［パターン14］オンプレミス環境との連携
