---
title: "AWS SOA セキュリティとコンプライアンス / ネットワーク"
emoji: "🔑"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["AWS","SOA"]
published: false
---

# 分野 5: セキュリティとコンプライアンス 18%

## IAM ※特に重要
### IAMロール
一時的にアクセスを許可。
  - 権利の委譲
  - **原則：アクセスキーよりIAMロール**
### IAMポリシー
IDやリソースに関連付けてアクセス許可を定義。
- IDベースのポリシー
  IAMユーザー、グループ、ロールにアタッチ。
  そのアイデンティティが実行できる内容 (そのアクセス許可) を指定できる。
- リソースベースのポリシー
  リソースにアタッチ。
  特定のIAMユーザーやアカウントに対するアクセスを制御できる。たとえば、バケットポリシーをS3バケットにアタッチして、アクセスするIAMユーザーを限定することができる。
### サービスコントロールポリシー (SCP) 
組織を管理するために使用できるポリシーのタイプ。
リソースのアクセス権限を組織単位でコントロールすることに利用。（ユーザー単位ではない）

SCPをOU(組織単位)にアタッチする(ガードレールを敷く) + IAMポリシーを付与(実際に権限を与える) →  IAMユーザーの操作権限は、SCPとIAMの両方で許可されている場合に対象リソースの実行が可能。つまり、**両方で 明示的に許可され かつ 明示的に拒否されていない** という権限設定の場合に、そのリソースに対する操作が許可されることになります。
##### 例
- SCP：EC2とRDSの全ての操作権限が許可
- IAMポリシー：EC2の削除権限のみをDeny、その他のEC2操作をAllow
→ 両方が明示されている「EC2インスタンスの削除以外の操作のみ」が実施できる。
### パワーユーザー
管理者権限以外のあらゆるAWSリソースに対する権限を有したユーザー。
（フルアクセスは、管理者権限も持つ。）

## Certificate Manager(ACM) 
- ACMがサポートされていないリージョンでは、IAM を Certificate Manager として使用する必要がある。
- IAM APIを使用して証明書を取得するには、get-server-certificateコマンドを使用して、証明書のARNを取得。
- 取得した証明書をELBに設定するためには、set-load-balancer-listener-ssl-certificateコマンドを使用して証明書を設定。
- ACMは期限切れ前に自動的に証明書を更新する。
- ACMはELBと統合して、ロードバランサーに証明書をデプロイできる。

## Guard Duty
セキュリティの観点から脅威を検知。
- 機械学習を利用した不正検知が可能です。 
- VPCフローログを解析できます。 
- IPアドレスやドメインリストを解析できます。 

## Artifact
AWSとの契約やコンプライアンスなどに関わる情報を一元管理することができるサービス。監査対応。(CodeArtifact は全く関係ない)
1. レポート機能
ISO認定、PCI(Payment Card Industry)、SOCレポートなどの AWSセキュリティ・コンプライアンスドキュメントをダウンロードできる。
2. 契約に関する機能
AWSとの契約を確認・管理。複数のアカウントに紐づく契約を管理。

## AWS Shield
マネージド型の分散サービス妨害 (DDoS) を防御するAWSサービス。
**SQLインジェクション、クロスサイトスクリプティング（XSS）、DDoS攻撃への対応としては、AWS Shield とWAFによる対応が不可欠。**
- スタンダード
  無料。通常、Cloudfrontなどを利用すると自動で適用される。
- アドバンスト
  アプリケーションを標的とした攻撃に対する高レベルな保護。リアルタイムのモニタリングが必要な場合に使用。

## WAF
ウェブエクスプロイトからウェブアプリケーションを保護するために役立つファイアウォール。
ルールを設定してルールがマッチしたアクセスを遮断する機能。
（監視はできない。）
守れるもの
　・SQLインジェクション攻撃
　・クロスサイトスクリプティング攻撃
　・OSコマンドインジェクション攻撃
　・DDoS攻撃

AWS WAFはOSI参照モデルの7層で行われるDDos攻撃を緩和できますが、
AWS Shieldは3層および4層で行われるDDos攻撃からWebサービスを防御します。

## RDS
- 保管時のRDS DBインスタンスとスナップショットを暗号化するには、**DBインスタンス作成時に**RDS DBインスタンスの暗号化オプションを有効にする。
- インスタンス作成時、**RDS側でSSL証明書が作成され**、DBインスタンスにインストールされる。
- メンテナンスウィンドウ
RDSのメンテナンスを定期的に実行。
OSの更新、DBバージョンの更新、サーバーに適用されたパッチの更新が実施される。
- RDS OracleではRDSのリードレプリカ機能ではなく、Oracle Data Guardを使用する必要がある。

## インポートキーペア
利用しているキーペアの複製を別リージョンに移行することで、既存キーペアを利用できる。
（AMIを新しいリージョンにコピーしてインスタンスを作成すると、別のリージョンで作成した既存のキーペアを選択することができません。そのため、基本的には新しいリージョンでは新規キーペアを作成することになります。しかしながら、現在のリージョンで利用しているPEMキーを共有したいという場合は、PEMキーを別リージョンにインポートすることができます。）

## 暗号化キー
### CSE (Client Side Encryption)
クライアント内で暗合化したオブジェクトをS3に登録して、暗号化キーの生成と管理はクライアント側で実行します。
### SSE-C (サーバサイド)
AWS側の暗号化キーではなく、ユーザが作成・管理する暗号化キーによって暗号化を実行。
### SSE-S3 (サーバサイド)
AWS S3で管理された暗号化キーによるサーバーサイド暗号化。
### AWS KMS
  AWSサービスとしてキーの作成と管理をマネージド型サービスで提供。
- キーポリシー
  KMSの発行するカスタマーマスターキーにアクセスできるユーザーを管理・変更できる。
### AWS CloudHSM
  大規模システム用。KMSではダメな、特殊な場合に使う。


# 分野 6: ネットワーク 14%

**原則：セキュリティグループは、許可のみ行う。ステートフル**
**原則：ネットワークACLは、明示的な拒否を行う。ステートレス**
特定のポートを介した特定のIPアドレスのセットからの攻撃に対しては、ネットワークACLで防御。

## VPC(IGW, NAT, VPCエンドポイント)
- IPv6 CIDRブロックのサイズ(/56)は固定。(独自のIPv6アドレス範囲を指定できない)
### VPCピアリング
2つのVPC間をセキュアに通信できる。
（例：異なるアカウントによって所有され、かつ別のリージョンのVPCで稼働されているインスタンス に、パブリックインターネットを通過せずにアクセスできる。）
### ルートのブラックホール状態(現象)
ルートのターゲットが利用できない状態。
ルートテーブルに設定したインターネットゲートウェイやNATゲートウェイを削除すると発生。

- DirectConnect

- VPN
  AWSのVPN接続には、デフォルトで*2つ*のVPNトンネルが利用される。これは最初の VPNトンネルに障害が発生した場合やメンテナンスにより停止している場合などに自動的に 2 番目の VPN トンネルにフェイルオーバーするように設定されている。 