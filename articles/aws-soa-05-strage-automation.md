---
title: "AWS SOA ストレージおよびデータの管理 / 自動化と最適化"
emoji: "🧰"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["AWS","SOA"]
published: false
---

# 分野 4: ストレージおよびデータの管理 12%

## S3(重要)
- ストレージクラス分析
  ストレージアクセスパターンを分析し、適切なデータをいつ適切なストレージクラスに移行すべきかを判断できる。
- アクセスログ
  アクセスログを有効化することで、S3バケットに対するリクエストの詳細が記録されます。これにより、セキュリティやアクセスの監査に役立ちます。
- S3 イベント機能
  バケット内でデータ削除や更新などの特定のイベントが発生したときに通知機能を設定することが可能。
  Amazon SNS 、Amazon SQSまたはLambdaを宛先に対してイベントを発行できる。
- S3 Select
  S3バケット内に保存したオブジェクトに対し、SQL文を用いてデータの一部分のみを取り出すことができるサービス。
- S3インベントリ
  バケットに保存されているすべてのオブジェクトの複製(バージョニング)および暗号化ステータスに関するレポートを生成することが可能。
- rbコマンド(remove bucket)
  バケットのバージョニングが有効化されていない場合にのみ、rb --force コマンドで、空ではないバケットを削除できる。このコマンドは、すべてのオブジェクトを削除した後にバケットを削除する。
- 5xxエラーを解決するには
  ・リクエストするアプリケーションの再試行メカニズムを有効にする
  ・リクエスト率を徐々に増やすようにアプリケーションを設定する
  ・複数のプレフィックスにオブジェクトを分散する 
  ・数百万のバージョンがあるオブジェクトが存在しているか確認する
- オブジェクトは同一のS3リージョン内の複数施設に分散した複数のデバイスに保存される。
- （未）バケットポリシー(JSON記述も理解)、4XX or5XX系のエラーに関するトラブルシューティング、マルチアップロード、S3通知機能、クロスオリジンリソース共有(CORS)
### Glacier deep archive
Glacierより更に安価・アクセスが少ないデータ保存に適したストレージクラス。
取り出しに12時間かかる。

## EBS
- EBS最適化
  EBS最適化をサポートするインスタンスタイプを選択することでEBSでのデータ処理パフォーマンスの改善ができる。
- スループット最適化HDD
  高いスループットを必要とする、アクセス頻度の高いワークロード向けの低コストのHDD。
- RAID0
  複数のボリュームを1つと捉える。ボリュームを追加すると、スループットとIOPSを追加したことになりI/Oパフォーマンスが向上。
- RAID1
  耐久性を向上させるミラーリング構成。
- 初期化
  新しいEBSボリュームは、利用可能になった時点で最大のパフォーマンスであり、初期化を必要としません。
  しかしながら、スナップショットから復元されたボリュームは、ブロックにアクセスする前に初期化する必要があります。各ブロックに最初にアクセスした際は、I / O操作のレイテンシが大幅に増加する可能性があるため。
  この状況はデータに1回アクセスするとパフォーマンスが復元されます。実稼働環境では、**ボリュームを使用する前にすべてのブロックからの読み取りを実行**することで、このパフォーマンスヒットを回避できます。このプロセスは初期化と呼ばれます。

## EFS

## インスタンスストア
インスタンスストアのバックアップは、インスタンスストアのデータを新しく作成したEBSにコピーする。（インスタンスストアにはスナップショットは作れない）

## StorageGateway
- キャッシュ型ボリューム
プライマリーデータ保存場所：S3
- 保管型ボリューム
プライマリーデータ保存場所：ローカルディスク

## Snowball
### Snowball Edge Storage Optimized
ストレージ容量は100TBであり、利用可能領域は80TB。
約1週間
### Snowmobile
AWS Snowファミリーの中でも特に超大容量データをAWSに移動するエクサバイト規模のデータ転送サービスとして利用されます。セミトレーラートラックが牽引する長さ 14mの丈夫な輸送コンテナとなっており、Snowmobile1台あたり100PBまでのデータを転送できます。


# 分野 7: 自動化と最適化 12%
## Lambda

## TrustedAdvisor(重要)
AWS環境を分析し、最適化するためのベストプラクティスを提供。（情報提供のみで、実行は別途必要。）
### コスト最適化
使われていないリソース (= 無駄なコスト) を検出するほか、利用状況を分析して、コスト削減が期待できる割引プランをおすすめ。
- EC2 リザーブドインスタンスの最適化
- アイドル状態の Amazon RDS DB インスタンス
- 使用率の低い Amazon EC2 Instances
- 関連付けられていない Elastic IP Address
### パフォーマンス
パフォーマンス低下に繋がる使い方をしていないかどうかチェックするほか、もっと効率がよい AWS の機能を使う余地がある場合にお知らせ。
- Amazon EC2 から EBS スループット最適化
- EC2 インスタンスセキュリティグループルールの増大
- 使用率の高い Amazon EC2インスタンス
- 利用率が高すぎる Amazon EBS マグネティックボリューム
### セキュリティ
セキュリティリスクのある設定になっていないかどうかチェックするほか、現在よりもセキュリティを高められる推奨の設定があればおすすめ。
- セキュリティグループ - 開かれたポート
- AWS CloudTrail ロギング
- Amazon EBS パブリックスナップショット
- IAM アクセスキーローテーション
- ルートアカウントの MFA
- 公開されたアクセスキー
### フォールトトレランス
過去データから復旧できるようにバックアップを取得しているか、AWS の機能を活用して冗長構成を取れているか、などの点をチェックする。
- Load Balancer の最適化
- Amazon RDS Multi-AZ
- Amazon Route 53 フェイルオーバーリソースレコードセット
- AWS Direct Connect 接続の冗長性
- Amazon EBS スナップショット
### サービス制限
AWS サービス制限の一部 (39 項目) に対して、現在の利用状況と制限値を比較して差分をチェック。
- そもそもサービス制限とは: AWS は各サービスにおいて、ア
カウント毎に利用可能なリソース (EC2 インスタンス台数、
リージョンあたりの VPC 数など) に制限をかけている。

## Inspector
⾃動セキュリティ診断サービス。
対象がEC2インスタンスのみ。（AWSの他のリソースを評価することができない）

## AWSサポート
人的なAWSのサポートサービス。

## コスト管理
- Cost Exploler、Billing Manager、AWS 使用状況レポート、組織内にアカウント招待、削除の際の流れ
- EC2 スポットブロック：スポットインスタンスを1~6時間継続して利用できることが担保された入札形式。
- コストと使用状況レポート
過去のコスト状況を確認できる。
- TCO計算ツール
見積もりツール。
- Redshiftのスナップショット低減によるコスト削減
Redshiftは、自動スナップショットで定期的にスナップショットを取得しているため、スナップショット量がかさむことで保存コストが増加している可能性がある。

## Cost Explorer

## Systems Manager
([参考サイト](https://dev.classmethod.jp/articles/relay-re-introduction-2019-ssm/))
サーバ群を管理する多機能なツールセットの総称。
（範囲が広すぎてどこまでが"AWS Systems Manager"というサービスの中に収めるべきなのかよくわからない）
  - シークレットデータの格納
### 使う前の手順
・SSM Agentの導入
・SSM AgentからSSM APIへの経路確保
・IAMロールの付与
### Patch Manager
OSパッチの管理。セキュリティ関連のアップデートおよびその他のタイプのアップデートの両方に関して、インスタンスへのパッチ適用プロセスを自動化します。オペレーティングシステムとアプリケーションの両方にパッチを適用することができます。
（AWS Batch：バッチコンピューティングワークロード(大規模計算)を実行）
### Systems Manager Automation
自動化ワークフローを構築して、EC2インスタンスおよび他のAWSリソースの一般的なメンテナンスとデプロイに関する運用タスクを自動化することが可能。

## StepFunctions
### ステートマシン
？
### ワークフロー
可視化のツール。
## (Simple Workflow)
Step Functionsが登場してからは古いサービスとなっており、利用は推奨されていません。一部、Amazon Simple Workflowしか実行できないタイプのワークフローには有効。

## Amazon DLM (Data Lifecycle Manager)
ある作業をスケジューリングして実行できる。