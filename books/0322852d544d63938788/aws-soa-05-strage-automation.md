---
title: "AWS SOA ストレージおよびデータの管理 / 自動化と最適化"
emoji: "🧰"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["AWS","SOA"]
published: false
---

# 分野 4: ストレージおよびデータの管理 12%

## S3(重要)
- オブジェクトは**同一のS3リージョン内の複数施設に分散した複数のデバイス**に保存される。
- ストレージクラス分析
  アクセスパターンを分析し、適切なデータをいつ適切なストレージクラスに移行すべきかを判断できる。
- アクセスログ
  アクセスログを有効化することで、S3バケットに対するリクエストの詳細が記録されます。これにより、セキュリティやアクセスの監査に役立ちます。
- rbコマンド(remove bucket)
  バケットのバージョニングが有効化されていない場合にのみ、rb --force コマンドで、空ではないバケットを削除できる。このコマンドは、すべてのオブジェクトを削除した後にバケットを削除する。
- 5xxエラーを解決するには
  ・リクエストするアプリケーションの再試行メカニズムを有効にする
  ・リクエスト率を徐々に増やすようにアプリケーションを設定する
  ・複数のプレフィックスにオブジェクトを分散する 
  ・数百万のバージョンがあるオブジェクトが存在しているか確認する
- マルチアップロード
  大容量オブジェクトのアップロードを効率よく行える。
- クロスオリジンリソース共有(CORS)
  別のドメインで読んだHTML内のJavascriptによるリクエスト（読み込み）を許可。
  そうすることで、JavaScript内のAjax通信でクロスドメインのS3から情報をダイレクトに取得できる。
### S3 イベント通知機能
  バケット内で特定のイベントが発生したとき、通知を設定することが可能。
  - イベント元：データの**登録・削除・更新**など
  - イベント先：**SNS, SQS, Lambda**
### S3へのアクセス制御(3種)
 1. アクセスコントロールリスト (ACL) 
  **バケット単位とオブジェクト単位**でのアクセス制御。
  （バケットポリシーはバケット単位。）
  ・READ : バケット内のオブジェクトをリストできる。
  ・WRITE : バケット内のオブジェクトを作成、上書き、削除できる
  ・READ_ACP : **バケットACL**を読み取ることができます。
  ・WRITE_ACP : **バケットのACL**を書き込むことができます。
  ・FULL_CONTROL : バケットのREAD、WRITE、READ_ACP、およびWRITE_ACP権限を許可。
 2. バケットポリシー
  **バケット単位**でのアクセス制御。
 3. IAMロール
  **ユーザ単位**でのアクセス制御。ポリシーを使い、ロールを用意する。
### S3 Select
  S3バケット内に保存したオブジェクトに対し、SQL文を用いてデータの一部分のみを取り出すことができるサービス。
### S3インベントリ
  バケットに保存されているすべてのオブジェクトの**複製(バージョニング)および暗号化ステータスに関するレポートを生成**することが可能。

### Glacier deep archive
Glacierより更に安価・アクセスが少ないデータ保存に適したストレージクラス。
取り出しに12時間かかる。

## Amazon Athena
標準SQLを使用してS3バケットにホストされている**データを分析し、レポートを作成**できる。

---

## EBS
- EBS最適化
  EBS最適化をサポートするインスタンスタイプを選択することでEBSでのデータ処理パフォーマンスの改善ができる。
- 初期化
  新しいEBSボリュームは、利用可能になった時点で最大のパフォーマンスであり、初期化を必要としません。
  しかしながら、スナップショットから復元されたボリュームは、ブロックにアクセスする前に初期化する必要があります。各ブロックに最初にアクセスした際は、I / O操作のレイテンシが大幅に増加する可能性があるため。
  この状況はデータに1回アクセスするとパフォーマンスが復元されます。実稼働環境では、**ボリュームを使用する前にすべてのブロックからの読み取りを実行**することで、このパフォーマンスヒットを回避できます。このプロセスは初期化と呼ばれます。
### 種類
- プロビジョンドIOPS SSD
  主な用途 : データベースのサーバー向けのボリュームなど。
- スループット最適化HDD (500 MiB/秒)
  汎用SSDより安価。
  HDDタイプのボリュームであり、SSDタイプのボリュームと比べるとレイテンシーが高いですが、Cold HDDと比較すると高速にデータを読み書きできます。
  高いスループットを必要とする、アクセス頻度の高いワークロード向けの低コストのHDD。
### RAID
- RAID0
  複数のボリュームを1つと捉える。ボリュームを追加すると、スループットとIOPSを追加したことになりI/Oパフォーマンスが向上。
- RAID1
  **耐久性を向上させるミラーリング構成**。
### EBS(EC2)をモニタリングするときの項目
- EBSReadOps
  インスタンスで利用できるすべてのEBSボリュームでの、完了した読み取り操作の数を取得。
- EBSWriteOps 
  インスタンスで利用できるすべてのEBSボリュームでの、完了した書き込み操作の数を取得。 
- EBSReadBytes 
  インスタンスで利用できるすべてのEBSボリュームでの、読み取られたバイト数を取得。 
- EBSWriteBytes 
  インスタンスで利用できるすべてのEBSボリュームでの、書き込まれたバイト数を取得。

---

## EFS
- ライフサイクル管理
選択したライフサイクルポリシーにもとづいて、保存データを自動的に低価格なEFS IAストレージクラスに移動させることができる。（S3のように）

## インスタンスストア
インスタンスストアのバックアップは、インスタンスストアのデータを**新しく作成したEBSにコピー**する。（インスタンスストアはスナップショットは作れない）

## StorageGateway
- **キャッシュ型**ボリューム
プライマリーデータ保存場所：**S3**
- **保管型**ボリューム
プライマリーデータ保存場所：**ローカルディスク**

## Snow ファミリー
### Snowball
特徴：コンピューティング能力が高い。
#### Snowball Edge Storage Opimized
ストレージ容量は100TBであり、利用可能領域は80TB。
約1週間
#### Snowball Edge Compute Opimized
ユースケースとして、機械学習、映像の処理・分析など。主にAWSへ転送する前段階で使用。
転送は可能ですが、速度が求められる場合はStorage Optimizedがおすすめ。
### Snowcone
特徴：持ち運びのしやすい小型サイズ。
### Snowmobile
特徴：データ転送に特化した大型コンテナ。
超大容量データをAWSに移動するエクサバイト規模のデータ転送サービス。セミトレーラートラックが牽引する長さ 14mの丈夫な輸送コンテナとなっており、Snowmobile1台あたり100PBまでのデータを転送できます。


# 分野 7: 自動化と最適化 12%

## TrustedAdvisor(重要)
下記の観点で**AWS環境を分析**し、最適化するためのベストプラクティスを提供。（情報提供のみで、実行は別途必要。）
### コスト最適化
使われていないリソース (= 無駄なコスト) を検出するほか、利用状況を分析して、コスト削減が期待できる割引プランをおすすめ。
- EC2 リザーブドインスタンスの最適化
- アイドル状態の Amazon RDS DB インスタンス
- 使用率の低い Amazon EC2 Instances
- 関連付けられていない Elastic IP Address
### パフォーマンス
パフォーマンス低下に繋がる使い方をしていないかどうかチェックするほか、もっと効率がよい AWS の機能を使う余地がある場合にお知らせ。
- Amazon EC2 から EBS スループット最適化
- EC2 インスタンスセキュリティグループルールの増大
- 使用率の高い Amazon EC2インスタンス
- 利用率が高すぎる Amazon EBS マグネティックボリューム
### セキュリティ
セキュリティリスクのある設定になっていないかどうかチェックするほか、現在よりもセキュリティを高められる推奨の設定があればおすすめ。
- セキュリティグループ - 開かれたポート
- AWS CloudTrail ロギング
- Amazon EBS パブリックスナップショット
- IAM アクセスキーローテーション
- ルートアカウントの MFA
- 公開されたアクセスキー
### フォールトトレランス
過去データから復旧できるようにバックアップを取得しているか、AWS の機能を活用して冗長構成を取れているか、などの点をチェックする。
- Load Balancer の最適化
- Amazon RDS Multi-AZ
- Amazon Route 53 フェイルオーバーリソースレコードセット
- AWS Direct Connect 接続の冗長性
- Amazon EBS スナップショット
### サービス制限
AWS サービス制限の一部 (39 項目) に対して、現在の利用状況と制限値を比較して差分をチェック。
- そもそもサービス制限とは: AWS は各サービスにおいて、ア
カウント毎に利用可能なリソース (EC2 インスタンス台数、
リージョンあたりの VPC 数など) に制限をかけている。

---

## コスト管理
### AWS Organizations 一括請求機能
  他のメンバーアカウントからは、請求情報にはアクセスできない。
### TCO計算ツール (見積り)
  見積もりツール。
  仮想マシン数・サーバー数・データ容量によって計算。
### Cost Explorer (可視化・予測)
コストと使用状況の経時的変化を可視化し、コスト予測をしてくれます。
Cost Explorerは利用状況を可視化して分析する際に利用します。
### コストと使用状況レポート (レポート作成)
ルートアカウントとIAMユーザーが使用した各サービスの利用状況が、時間単位または日単位の明細項目レベルで確認・集計することが可能なレポート。
CSV形式により、ユーザーが指定したS3バケットに保存します。レポートは最低1日に1回以上更新されます。
### AWS Budgets (監視)
予算のしきい値を超えたときにアラートを発信するカスタム予算を設定します。
AWS Budgets を使用して予約の使用率またはカバレッジターゲットを設定し、使用率が設定したしきい値を下回った場合にアラートを受け取ることもできます。
### AWSコンソールの アカウント設定 (アラート)
請求アラートを有効にできる。また請求内容の詳細も確認することが可能。
### TrustedAdvisor (無駄を発見)
(上で記載)

---

## Systems Manager
([参考サイト](https://dev.classmethod.jp/articles/relay-re-introduction-2019-ssm/))
サーバ群を管理する多機能なツールセットの総称。
（範囲が広すぎてどこまでが"AWS Systems Manager"というサービスの中に収めるべきなのかよくわからない）
  - シークレットデータの格納
### 使う前の手順
・SSM Agentの導入(AMIには導入済み) → SystemsManager管理化のインスタンス（マネージドインスタンス）にする
・SSM AgentからSSM APIへの経路確保
・インスタンスへのIAMロールの付与

上記を簡単に実行できるのが、[クイックセットアップ]。
### Patch Manager
OSパッチの管理。セキュリティ関連のアップデートおよびその他のタイプのアップデートの両方に関して、インスタンスへのパッチ適用プロセスを自動化します。オペレーティングシステムとアプリケーションの両方にパッチを適用することができます。
（AWS Batch：バッチコンピューティングワークロード(大規模計算)を実行）
### Systems Manager Automation
自動化ワークフローを構築して、EC2インスタンスおよび他のAWSリソースの一般的なメンテナンスとデプロイに関する運用タスクを自動化することが可能。
### Systems Manager パラメータストア
CloudFormationテンプレートのパラメーターストアセクションで設定することで、Systems Managerのパブリックパラメータストアを参照して最新AMIを引っ張ってくることができます。
テンプレートやパラメータなど何も変更せずにCloudFormationスタックを更新するだけでリソースの要件に応じて、その時点で最新のAMI IDに更新されます。

## StepFunctions
### ステートマシン
処理の工程。
### ワークフロー
可視化ツール。
## (Simple Workflow)
Step Functionsが登場してからは古いサービスとなっており、利用は推奨されていません。一部、Amazon Simple Workflowしか実行できないタイプのワークフローには有効。

## Amazon DLM (Data Lifecycle Manager)
ある作業をスケジューリングして実行できる。

---

## Inspector
⾃動**セキュリティ診断**サービス。
対象が**EC2インスタンスのみ**。（AWSの他のリソースを評価することができない）

## AWSサポート
人的なAWSのサポートサービス。
| プラン種類 | ベーシック | 開発者 | ビジネス | エンタープライズ |
| --- | --- | --- | --- | --- |
| 問合せ方法 | インスタンスのヘルスチェック不合格時のみ | メール | 電話 | 電話, テクニカルアカウントマネージャへの直接問合せ |
